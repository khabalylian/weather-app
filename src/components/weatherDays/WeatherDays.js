import { useDispatch, useSelector } from "react-redux";
import { useEffect } from 'react';
import { fetchWeatherDays } from "../../slice/weatherSlice";
import Spinner from "../spinner/Spinner";
import Error from "../error/Error";

const WeatherDays = () => {
    const dispatch = useDispatch();
    const weatherDay = useSelector(state => state.weather.weatherDay);
    const dayLoadingStatus = useSelector(state => state.weather.dayLoadingStatus);
    const weatherCordCheak = useSelector(state => state.weather.weatherCordCheak);
    
    useEffect(() => {
        dispatch(fetchWeatherDays(localStorage.getItem('Cord')));
        // eslint-disable-next-line
    }, [weatherCordCheak])

    const renderItem = (arr) => {
        const items = arr.map((item, index) => {
            let {day, icon, tempMin, tempMax} = item;
            const src = `https://openweathermap.org/img/wn/${icon}@2x.png`;

            if(index === 0)day = 'Сьогодні';
            else if (index === 1) day = 'Завтра';

            return (
                <div key={index} className="item weather-days__item">
                    <p className="item__day">{day}</p>
                    <div className="item__weather">
                        <img className="item__weather-icon" src={src} alt="weatherIcon"/>
                    </div>
                    <div className="item__temp">
                        <div className="item__temp-max">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="20"
                                height="20"
                                x="0"
                                y="0"
                                enableBackground="new 0 0 612 612"
                                version="1.1"
                                viewBox="0 0 612 612"
                                xmlSpace="preserve"
                                >
                                <path fill="#E8F3F9" d="M76.5 286.875H19.125C8.568 286.875 0 295.443 0 306s8.568 19.125 19.125 19.125H76.5c10.557 0 19.125-8.568 19.125-19.125s-8.568-19.125-19.125-19.125zM306 95.625c10.557 0 19.125-8.568 19.125-19.125V19.125C325.125 8.568 316.557 0 306 0s-19.125 8.568-19.125 19.125V76.5c0 10.557 8.568 19.125 19.125 19.125zm184.002 53.167l40.182-40.182c7.401-7.401 7.401-19.393 0-26.794s-19.394-7.401-26.795 0l-40.182 40.182c-7.401 7.401-7.401 19.393 0 26.794 7.402 7.402 19.394 7.402 26.795 0zM141.716 443.509l-40.182 40.182c-7.401 7.401-7.401 19.393 0 26.794s19.393 7.401 26.794 0l40.182-40.182c7.401-7.401 7.401-19.393 0-26.794s-19.392-7.402-26.794 0zm-11.513-286.263c7.478 7.478 19.584 7.478 27.042 0 7.459-7.478 7.459-19.584 0-27.042L116.682 89.62c-7.478-7.478-19.584-7.478-27.043 0-7.478 7.478-7.478 19.584 0 27.043l40.564 40.583zM306 516.375c-10.557 0-19.125 8.568-19.125 19.125v57.375c0 10.557 8.568 19.125 19.125 19.125s19.125-8.568 19.125-19.125V535.5c0-10.557-8.568-19.125-19.125-19.125zm175.797-61.621c-7.478-7.478-19.584-7.478-27.043 0-7.478 7.479-7.478 19.584 0 27.043l40.564 40.564c7.478 7.478 19.584 7.478 27.043 0 7.459-7.479 7.478-19.584 0-27.043l-40.564-40.564zm111.078-167.879H535.5c-10.557 0-19.125 8.568-19.125 19.125s8.568 19.125 19.125 19.125h57.375c10.557 0 19.125-8.568 19.125-19.125s-8.568-19.125-19.125-19.125zM306 133.76c-95.128 0-172.24 77.112-172.24 172.24S210.872 478.24 306 478.24 478.24 401.128 478.24 306 401.128 133.76 306 133.76zm0 306.077c-73.918 0-133.837-59.919-133.837-133.837S232.082 172.163 306 172.163 439.837 232.082 439.837 306 379.918 439.837 306 439.837z"></path>
                            </svg>
                            <span>{tempMax}°</span>
                        </div>
                        <span className="item__row">|</span>
                        <div className="item__temp-min">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="20"
                                height="20"
                                viewBox="0 0 512 512"
                                >
                                <g>
                                    <path
                                    fill="#E8F3F9"
                                    d="M232.035 348.436c-84.624-83.22-90.875-214.311-18.779-304.617-29.909 11.201-57.955 28.641-82.051 52.338-91.39 89.871-91.39 235.582 0 325.453s239.564 89.871 330.953 0a233.396 233.396 0 0018.779-20.836c-83.529 31.279-181.608 13.838-248.902-52.338z"
                                    ></path>
                                    <path
                                    fill="none"
                                    stroke="#9B64E2"
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    strokeMiterlimit="10"
                                    strokeWidth="10"
                                    d="M212.035 328.436c-84.624-83.22-90.875-214.311-18.779-304.617-29.909 11.201-57.955 28.641-82.051 52.338-91.39 89.871-91.39 235.582 0 325.453s239.564 89.871 330.953 0a233.396 233.396 0 0018.779-20.836c-83.529 31.279-181.608 13.838-248.902-52.338z"
                                    ></path>
                                    <path
                                    fill="#E8F3F9"
                                    d="M340.366 107.767c-1.411-4.979-8.237-5.646-9.925 0-1.557 5.211-3.409 9.312-8.762 14.659-5.353 5.351-15.126 9.866-17.767 9.866-5.06 0-4.139 9.798 0 9.925 4.139.126 11.037 1.471 16.139 6.571 5.104 5.105 9.513 13.871 10.38 17.174.867 3.306 7.752 3.949 9.067-.874 1.315-4.827 5.871-11.346 10.822-16.3 4.951-4.95 12.033-8.336 14.607-8.151 2.578.185 6.121-8.249 0-9.925-6.119-1.675-11.475-2.55-15.259-6.333-3.78-3.782-7.581-10.547-9.302-16.612zM424.233 171.309c-.968-3.414-5.648-3.871-6.806 0-1.067 3.572-2.337 6.384-6.007 10.051-3.671 3.669-10.372 6.765-12.183 6.765-3.469 0-2.838 6.719 0 6.806 2.838.086 7.568 1.008 11.065 4.506 3.5 3.5 6.523 9.511 7.117 11.775.595 2.267 5.315 2.708 6.218-.6.901-3.31 4.025-7.779 7.42-11.176 3.396-3.395 8.251-5.716 10.017-5.59 1.768.127 4.196-5.655 0-6.805-4.196-1.148-7.868-1.748-10.463-4.343-2.592-2.593-5.198-7.231-6.378-11.389z"
                                    ></path>
                                    <g>
                                    <path
                                        fill="#9B64E2"
                                        d="M315.305 111.434c2.13 3.866 4.663 7.385 7.295 10.018 2.217 2.216 4.66 3.781 7.171 4.96-2.456 1.654-4.714 3.5-6.522 5.308-2.752 2.754-5.811 6.365-8.372 10.266-2.168-3.644-4.837-7.351-7.754-10.268a30.717 30.717 0 00-7.319-5.401c3.464-2.116 6.666-4.537 8.945-6.815 2.817-2.818 4.921-5.463 6.556-8.068m.006-17.656c-2.029 0-4.052 1.254-4.869 3.988-1.557 5.211-3.409 9.312-8.762 14.659-5.353 5.351-15.126 9.866-17.767 9.866-5.06 0-4.139 9.798 0 9.925 4.139.126 11.037 1.471 16.139 6.571 5.104 5.105 9.513 13.871 10.38 17.174.428 1.629 2.317 2.612 4.28 2.612 2.021 0 4.12-1.04 4.787-3.486 1.315-4.827 5.871-11.346 10.822-16.3 4.822-4.821 11.666-8.158 14.397-8.158.073 0 .143.002.21.007l.084.003c2.569 0 5.971-8.271-.084-9.928-6.119-1.675-11.475-2.55-15.259-6.333-3.782-3.782-7.583-10.547-9.304-16.612-.726-2.567-2.894-3.988-5.054-3.988zM400.555 176.219c.954 1.322 1.96 2.524 2.986 3.551a19.317 19.317 0 001.643 1.466c-.422.377-.822.755-1.198 1.131a50.607 50.607 0 00-3.387 3.774 33.755 33.755 0 00-3.223-3.775 24.334 24.334 0 00-1.658-1.51 30.27 30.27 0 002.771-2.422 41.825 41.825 0 002.066-2.215m.212-17.645c-1.392 0-2.778.859-3.339 2.734-1.067 3.572-2.337 6.384-6.007 10.051-3.671 3.669-10.372 6.765-12.183 6.765-3.469 0-2.838 6.719 0 6.806 2.838.086 7.568 1.008 11.065 4.506 3.5 3.5 6.523 9.511 7.117 11.775.293 1.117 1.589 1.791 2.936 1.791 1.385 0 2.824-.713 3.282-2.391.901-3.31 4.025-7.779 7.42-11.176 3.308-3.307 8-5.595 9.873-5.595.05 0 .098.002.144.005l.058.002c1.762 0 4.094-5.67-.058-6.807-4.196-1.148-7.868-1.748-10.463-4.343-2.594-2.593-5.199-7.231-6.379-11.39-.499-1.759-1.985-2.733-3.466-2.733z"
                                    ></path>
                                    </g>
                                </g>
                            </svg>
                            <span>{tempMin}°</span>
                        </div>
                    </div>
                </div> 
            )
        })

        return (
            <div className="weather-days__items">
                  {items}      
             </div>
        )
    }
    
    const weatherItems = dayLoadingStatus === 'loading' ? <Spinner/> : renderItem(weatherDay);
    const error = dayLoadingStatus === 'error' ? <Error/> : null;

    return (
        <div className="weather-days">
            <div className="weather-days__container">
                {error}
                {weatherItems}
            </div>
        </div>
    )
}

export default WeatherDays;